<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸‹æ»ãƒãƒƒãƒ—ï¼†ãƒ©ã‚¸ã‚ª</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        body {
            font-family: sans-serif;
            text-align: center;
            padding: 0;
            margin: 0;
            background-color: #f0f0f0;
        }
        h1 { font-size: 1.2rem; margin: 10px; }
        
        /* åœ°å›³ã®è¦‹ãŸç›®è¨­å®š */
        #map {
            height: 400px; /* åœ°å›³ã®é«˜ã• */
            width: 100%;
            margin-bottom: 20px;
            z-index: 1;
        }

        .controls { padding: 10px; }
        
        .status {
            margin: 10px auto;
            padding: 10px;
            background: white;
            border-radius: 8px;
            font-weight: bold;
            width: 90%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        button {
            font-size: 1.1rem;
            padding: 12px 24px;
            margin: 5px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            width: 45%;
            color: white;
        }
        #btn-play { background-color: #007bff; }
        #btn-stop { background-color: #dc3545; display: none; }
    </style>
</head>
<body>

    <h1>ğŸš— æ¸‹æ»ãƒãƒƒãƒ—ï¼†ãƒ©ã‚¸ã‚ª</h1>
    
    <div id="map"></div>

    <div class="controls">
        <div class="status" id="status-text">åœæ­¢ä¸­</div>
        <button id="btn-play" onclick="startRadio()">å†ç”Ÿ</button>
        <button id="btn-stop" onclick="stopRadio()">åœæ­¢</button>
    </div>

    <script>
        // --- 1. åœ°å›³ã®è¨­å®š ---
        // æ±äº¬é§…å‘¨è¾ºã‚’ä¸­å¿ƒ(35.6812, 139.7671)ã«ã€ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«11ã§è¡¨ç¤º
        var map = L.map('map').setView([35.685, 139.752], 12);

        // åœ°å›³ã®ã‚¿ã‚¤ãƒ«ï¼ˆèƒŒæ™¯ç”»åƒï¼‰ã‚’èª­ã¿è¾¼ã‚€
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);

        // --- æ¸‹æ»ãƒ©ã‚¤ãƒ³ã‚’æãé–¢æ•° ---
        function drawTraffic(coords, color, description) {
            // ç·šã‚’å¼•ã
            L.polyline(coords, {color: color, weight: 6, opacity: 0.7}).addTo(map);
            // ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã«æƒ…å ±ã‚’å‡ºã™ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—
            if(description) {
                 L.marker(coords[0]).addTo(map).bindPopup(description);
            }
        }

        // â˜…â˜…â˜… ã“ã“ã§æ¸‹æ»ç®‡æ‰€ï¼ˆèµ¤ã„ç·šï¼‰ã‚’æç”»ã—ã¦ã„ã¾ã™ â˜…â˜…â˜…
        // é¦–éƒ½é«˜ éƒ½å¿ƒç’°çŠ¶ç·š(C1)ã£ã½ã„ãƒ«ãƒ¼ãƒˆã‚’èµ¤ãã™ã‚‹ï¼ˆã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ï¼‰
        var c1Route = [
            [35.69, 139.77], // ç¥ç”°ã‚ãŸã‚Š
            [35.68, 139.77], // äº¬æ©‹ã‚ãŸã‚Š
            [35.67, 139.76], // éŠ€åº§ã‚ãŸã‚Š
            [35.66, 139.74], // è™ãƒé–€ã‚ãŸã‚Š
            [35.69, 139.75]  // ç«¹æ©‹ã‚ãŸã‚Š
        ];
        drawTraffic(c1Route, 'red', 'éƒ½å¿ƒç’°çŠ¶ç·šï¼šäº‹æ•…æ¸‹æ» 2km');

        // æ±åé«˜é€Ÿã£ã½ã„ãƒ«ãƒ¼ãƒˆã‚’ç·‘ï¼ˆé †èª¿ï¼‰ã«ã™ã‚‹
        var tomeiRoute = [
            [35.65, 139.69], // æ¸‹è°·ãƒ»æ± å°»
            [35.62, 139.62], // ä¸–ç”°è°·
            [35.59, 139.56]  // å·å´æ–¹é¢
        ];
        drawTraffic(tomeiRoute, 'green', '3å·æ¸‹è°·ç·šãƒ»æ±åï¼šé †èª¿');


        // --- 2. éŸ³å£°ãƒ©ã‚¸ã‚ªã®è¨­å®šï¼ˆå‰å›ã¨åŒã˜ï¼‰ ---
        const trafficInfoList = [
            "ã“ã¡ã‚‰ã¯äº¤é€šæƒ…å ±ãƒ©ã‚¸ã‚ªã§ã™ã€‚",
            "åœ°å›³ä¸Šã®èµ¤ã„ãƒ©ã‚¤ãƒ³ã¯ã€ç¾åœ¨æ¸‹æ»ã—ã¦ã„ã‚‹ç®‡æ‰€ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚",
            "ç¾åœ¨ã€é¦–éƒ½é«˜é€Ÿéƒ½å¿ƒç’°çŠ¶ç·šã€éŠ€åº§ä»˜è¿‘ã§äº‹æ•…ã®ãŸã‚æ¸‹æ»ã—ã¦ã„ã¾ã™ã€‚",
            "ã„ã£ã½ã†ã€3å·æ¸‹è°·ç·šã‹ã‚‰æ±åé«˜é€Ÿæ–¹é¢ã¯ã€ç·‘è‰²ã®ãƒ©ã‚¤ãƒ³ã§è¡¨ç¤ºã•ã‚Œã¦ãŠã‚Šã€é †èª¿ã«æµã‚Œã¦ã„ã¾ã™ã€‚",
            "ç”»é¢ã®åœ°å›³ã¯ã€æŒ‡ã§å‹•ã‹ã—ãŸã‚Šæ‹¡å¤§ç¸®å°ãŒã§ãã¾ã™ã€‚"
        ];

        let isPlaying = false;
        let currentLine = 0;
        const synth = window.speechSynthesis;

        function startRadio() {
            if (isPlaying) return;
            isPlaying = true;
            synth.cancel();
            document.getElementById('btn-play').style.display = 'none';
            document.getElementById('btn-stop').style.display = 'inline-block';
            document.getElementById('status-text').innerText = "æ”¾é€ä¸­...";
            speakNextLine();
        }

        function stopRadio() {
            isPlaying = false;
            synth.cancel();
            document.getElementById('btn-play').style.display = 'inline-block';
            document.getElementById('btn-stop').style.display = 'none';
            document.getElementById('status-text').innerText = "åœæ­¢ä¸­";
        }

        function speakNextLine() {
            if (!isPlaying) return;
            const text = trafficInfoList[currentLine];
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ja-JP';
            utterance.onend = function() {
                if (!isPlaying) return;
                currentLine++;
                if (currentLine >= trafficInfoList.length) currentLine = 0;
                setTimeout(speakNextLine, 1000);
            };
            synth.speak(utterance);
            document.getElementById('status-text').innerText = text;
        }
    </script>
</body>
</html>
